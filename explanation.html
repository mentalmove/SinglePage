<!DOCTYPE html>
<html>
    <head>
        <title>Explanation for step 8</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
        
        Now, content shall only be generated on demand.
        The rule is easy: Whenever the actual visible section
        is the last one of the page, a new one shall be created.
        Therefore,
        <br>
        <tt style="font-size: 0.8em; padding-left: 24px">load_pages(section.index + 1);</tt>
        <br>
        from
        <br>
        <span style="font-size: 0.8em; padding-left: 24px">function</span> <tt style="font-size: 0.8em">dom_changed()</tt>
        <br>
        shall move to
        <br>
        <span style="font-size: 0.8em; padding-left: 24px">function</span> <tt style="font-size: 0.8em">compare_sections()</tt>
        <br>
        and be written as
        <br>
        <tt style="font-size: 0.8em; padding-left: 24px">if ( i == (sections.length - 1) )</tt>     <br>
        <tt style="font-size: 0.8em; padding-left: 48px">load_pages(sections.length);</tt>
        <br><br>
        That makes two changes in <tt style="font-size: 0.8em">dom_changed()</tt> necessary:
        <br>
        Firstly, <tt style="font-size: 0.8em">get_position(section);</tt>
        must be called directly after inserting the section into the DOM
        (a potential scroll event would need this information).
        <br>
        Secondly, <tt style="font-size: 0.8em">compare_sections(true);</tt>
        must be called here at least when the first section is created -
        otherwise, without a scroll event, a second section will never be built,
        and without a second section, a scroll event will never be fired.
        
    </body>
</html>
